@using EXE201.Commons.Models
@model List<Blog>

@{
    var ListType = new List<string>
    {
        "Bệnh tâm lý phổ biến",
        "Rối loạn tâm trạng",
        "Tâm lý học lâm sàng",
        "Kỹ năng quản lý cảm xúc",
        "Tư vấn và trị liệu tâm lý"
    };
}

<style>
    /* Toast Notification Styles */
    .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .custom-toast {
        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        color: white;
        padding: 16px 20px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(76, 175, 80, 0.3);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 320px;
        max-width: 400px;
        transform: translateX(100%);
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

        .custom-toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .custom-toast.hide {
            transform: translateX(100%);
            opacity: 0;
        }

    .toast-icon {
        font-size: 20px;
        background: rgba(255, 255, 255, 0.2);
        padding: 8px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 36px;
        height: 36px;
    }

    .toast-content {
        flex: 1;
    }

    .toast-title {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 2px;
        line-height: 1.2;
    }

    .toast-message {
        font-size: 13px;
        opacity: 0.9;
        line-height: 1.3;
    }

    .toast-close {
        background: none;
        border: none;
        color: white;
        font-size: 18px;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s ease;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
    }

        .toast-close:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
        }

    .toast-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        background: rgba(255, 255, 255, 0.3);
        width: 100%;
        transform-origin: left;
        animation: progressBar 5s linear forwards;
    }

    @@keyframes progressBar {
        from {
            transform: scaleX(1);
        }

        to {
            transform: scaleX(0);
        }
    }

    /* Success Toast */
    .custom-toast.success {
        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        box-shadow: 0 8px 32px rgba(76, 175, 80, 0.3);
    }

    /* Error Toast */
    .custom-toast.error {
        background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        box-shadow: 0 8px 32px rgba(244, 67, 54, 0.3);
    }

    }

    /* Responsive design */
    @@media (max-width: 768px) {
        .toast-container {
            top: 10px;
            right: 10px;
            left: 10px;
        }

        .custom-toast {
            min-width: auto;
            max-width: none;
        }
    }

</style>

<link rel="stylesheet" href="@Url.Content("~/css/blogIndex.css")" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="toast-container" id="toastContainer"></div>

<div class="blog-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Tìm kiếm blog..." id="searchInput" />
            <button type="button" class="search-icon" id="searchButton"><i class="fas fa-search"></i></button> <!-- Unicode icon -->
        </div>

        @for (int i = 0; i < ListType.Count; i++)
        {
            <div class="filter-section">
                <div class="filter-item">
                    <input type="checkbox" class="filter-checkbox" id="filterType_@i" />
                    <label for="filterType_@i">@ListType[i]</label>
                </div>
            </div>
        }

        
    </div>
    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h2 class="page-title">Các bài viết</h2>
            @if (User.IsInRole("Admin") || User.IsInRole("Psychologist"))
            {
                <div id="createButton">
                    <a href="@Url.Action("Create", "Blogs")" class="create-button">Tạo bài viết</a>
                </div>
            }
        </div>

        <div class="blog-grid" id="staffTableBody">
            @if (Model != null && Model.Any())
            {
                
                        @foreach (var blog in Model)
                        {
                                <div class="blog-card" data-type="@blog.BlogType" onclick="window.location.href='@Url.Action("Detail", new { id = blog.Id })'">
                                    @if (!string.IsNullOrEmpty(blog.ThumbnailUrl))
                                    {
                                        <img src="@blog.ThumbnailUrl" alt="thumbnail" class="blog-thumbnail" />
                                    }
                                    else
                                    {
                                        <div class="thumbnail-placeholder">
                                            Thumbnail
                                        </div>
                                    }

                                    <div class="blog-content">
                                        <h3 class="blog-title">@blog.Title</h3>
                                        <p class="blog-summary">@blog.Summary</p>
                                        <p class="blog-author">By: @blog.Author.Name</p>
                                    </div>
                                </div>
                        }
 
            }
            else
            {
                <div class="no-blogs">
                    <p>Chưa có blog nào được tạo.</p>
                </div>
            }
        </div>
        <!-- Nơi hiện thông báo khi không có kết quả -->
        <div class="no-data-message" style="display: none;">
            <p>Không tìm thấy dữ liệu phù hợp.</p>
        </div>
    </div>
</div>
<!-- Toast Notification Container -->



@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        var ListType = @Html.Raw(Json.Serialize(ListType));

        document.addEventListener('DOMContentLoaded', function() {
            function showNoDataMessage(show) {
                const noDataDiv = document.querySelector('.no-data-message');
                const blogContainer = document.getElementById('staffTableBody');

                if (show) {
                    noDataDiv.style.display = 'block';
                    blogContainer.style.display = 'none';
                } else {
                    noDataDiv.style.display = 'none';
                    blogContainer.style.display = 'block';
                }
            }

            function performFilter() {
                const searchTerm = $('#searchInput').val().toLowerCase().trim();
                const selectedTypes = [];

                $('.filter-checkbox:checked').each(function () {
                    const index = $(this).attr('id').split('_')[1];
                    selectedTypes.push(ListType[index]);
                });

                let visibleCount = 0;
                $('#staffTableBody .blog-card').each(function () {
                    const title = $(this).find('.blog-title').text().toLowerCase();
                    const summary = $(this).find('.blog-summary').text().toLowerCase();
                    const author = $(this).find('.blog-author').text().toLowerCase();
                    const blogType = $(this).data('type');

                    const matchesSearch = !searchTerm ||
                        title.includes(searchTerm) ||
                        summary.includes(searchTerm) ||
                        author.includes(searchTerm);

                    const matchesType = selectedTypes.length === 0 || selectedTypes.includes(blogType);

                    if (matchesSearch && matchesType) {
                        $(this).show();
                        visibleCount++;
                    } else {
                        $(this).hide();
                    }
                });

                showNoDataMessage(visibleCount === 0);
            }

            $('#searchButton').on('click', performFilter);

            $('#searchInput').on('keypress', function (e) {
                if (e.which === 13) {
                    e.preventDefault();
                    performFilter();
                }
            });

            $('.filter-checkbox').on('change', performFilter);
        });
    </script>

    <script>
        // Toast Notification JavaScript
        class ToastManager {
            constructor() {
                this.container = document.getElementById('toastContainer');
                this.toasts = [];
            }

            show(type, title, message, duration = 3000) {
                const toast = this.createToast(type, title, message, duration);
                this.container.appendChild(toast);
                this.toasts.push(toast);

                // Trigger animation
                setTimeout(() => toast.classList.add('show'), 10);

                // Auto remove after duration
                setTimeout(() => this.hide(toast), duration);

                return toast;
            }

            createToast(type, title, message, duration) {
                const toast = document.createElement('div');
                toast.className = `custom-toast ${type}`;

                const iconMap = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-circle',
                    warning: 'fas fa-exclamation-triangle',
                    info: 'fas fa-info-circle'
                };

                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="${iconMap[type]}"></i>
                    </div>
                    <div class="toast-content">
                        <div class="toast-title">${title}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                    <button class="toast-close" onclick="toastManager.hide(this.parentElement)">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="toast-progress"></div>
                `;

                return toast;
            }

            hide(toast) {
                if (!toast || !toast.parentElement) return;

                toast.classList.add('hide');
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.parentElement.removeChild(toast);
                    }
                    this.toasts = this.toasts.filter(t => t !== toast);
                }, 400);
            }

            success(title, message, duration) {
                return this.show('success', title, message, duration);
            }

        }

        // Initialize toast manager
        const toastManager = new ToastManager();

        // Check for success message from TempData
        document.addEventListener('DOMContentLoaded', function() {
            @if (TempData["SuccessBlog"] != null)
            {
                        <text>
                        toastManager.success(
                            'Thành công!',
                                '@TempData["SuccessBlog"]'
                        );
                        </text>
            }
            
        });

        // Example usage (you can call these from anywhere in your code)
        function showExampleToasts() {
            toastManager.success('Thành công!', 'Chứng chỉ đã được tải lên thành công.');
            setTimeout(() => toastManager.error('Lỗi!', 'Có lỗi xảy ra khi xử lý yêu cầu.'), 2000);
            setTimeout(() => toastManager.warning('Cảnh báo!', 'Vui lòng kiểm tra lại thông tin.'), 2000);
            setTimeout(() => toastManager.info('Thông tin!', 'Hệ thống sẽ được bảo trì vào 2h sáng.'), 1000);
        }
    </script>


 }